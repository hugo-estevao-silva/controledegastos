<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Cart√£o de Cr√©dito</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab-button {
            padding: 15px 30px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            flex: 1;
        }

        .tab-button.active {
            color: #3b82f6;
            background: white;
            border-bottom-color: #3b82f6;
        }

        .tab-button:hover {
            background: #f1f5f9;
            color: #3b82f6;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .form-section h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
            font-size: 14px;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #059669;
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f9fafb;
        }

        .currency {
            color: #059669;
            font-weight: 600;
        }

        .setup-section {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .setup-section h3 {
            margin-bottom: 15px;
            font-size: 24px;
        }

        .setup-steps {
            background: white;
            color: #1e293b;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .setup-steps ol {
            margin-left: 20px;
        }

        .setup-steps li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .visualization-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .summary-total {
            font-size: 48px;
            font-weight: bold;
            color: #3b82f6;
            text-align: center;
            margin: 20px 0;
        }

        .filters {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .tab-button {
                font-size: 14px;
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí≥ Controle de Gastos</h1>
            <p>Gerencie seus cart√µes e gastos de forma inteligente</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('setup')">
                üîß Configura√ß√£o
            </button>
            <button class="tab-button" onclick="switchTab('compras')">
                üìù Compras
            </button>
            <button class="tab-button" onclick="switchTab('visualizacao')">
                üìä Relat√≥rios
            </button>
        </div>

        <!-- Aba de Configura√ß√£o -->
        <div id="setup" class="tab-content active">
            <div class="setup-section">
                <h3>üöÄ Configura√ß√£o Inicial</h3>
                <p>Configure a integra√ß√£o com o Google Sheets para salvar seus dados</p>
            </div>

            <div class="form-section">
                <h2>üìã ID da Planilha do Google Sheets</h2>
                <div class="setup-steps">
                    <h4>Como obter o ID da sua planilha:</h4>
                    <ol>
                        <li>Abra o Google Sheets e crie uma nova planilha</li>
                        <li>Na URL, copie o ID que aparece entre "/d/" e "/edit"</li>
                        <li>Exemplo: https://docs.google.com/spreadsheets/d/<strong>SEU_ID_AQUI</strong>/edit</li>
                        <li>Cole o ID no campo abaixo e clique em "Conectar"</li>
                        <li>Compartilhe a planilha como "Qualquer pessoa com o link pode editar"</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label for="spreadsheetId">ID da Planilha</label>
                    <input type="text" id="spreadsheetId" placeholder="Cole aqui o ID da sua planilha" required>
                </div>
                <button class="btn btn-primary" onclick="conectarPlanilha()">
                    üîó Conectar Planilha
                </button>
                
                <div id="connectionStatus" class="hidden"></div>
            </div>

            <!-- Configura√ß√£o de Cart√µes -->
            <div class="form-section" id="cartoesConfig" style="display: none;">
                <h2>üí≥ Configurar Cart√µes</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeCartao">Nome do Cart√£o</label>
                        <input type="text" id="nomeCartao" placeholder="Ex: Nubank, Inter, C6" required>
                    </div>
                    <div class="form-group">
                        <label for="diaFechamento">Dia de Fechamento</label>
                        <select id="diaFechamento" required>
                            <option value="">Selecione o dia</option>
                            <option value="1">Dia 1</option>
                            <option value="5">Dia 5</option>
                            <option value="10">Dia 10</option>
                            <option value="15">Dia 15</option>
                            <option value="20">Dia 20</option>
                            <option value="25">Dia 25</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="diaVencimento">Dia de Vencimento</label>
                        <select id="diaVencimento" required>
                            <option value="">Selecione o dia</option>
                            <option value="5">Dia 5</option>
                            <option value="10">Dia 10</option>
                            <option value="15">Dia 15</option>
                            <option value="20">Dia 20</option>
                            <option value="25">Dia 25</option>
                            <option value="30">Dia 30</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="limiteCartao">Limite (R$)</label>
                        <input type="number" id="limiteCartao" step="0.01" min="0" placeholder="Opcional">
                    </div>
                </div>
                <button class="btn btn-success" onclick="adicionarCartao()">
                    ‚ûï Adicionar Cart√£o
                </button>

                <div class="table-container" style="margin-top: 30px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Cart√£o</th>
                                <th>Fechamento</th>
                                <th>Vencimento</th>
                                <th>Limite</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaCartoes">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Aba de Compras -->
        <div id="compras" class="tab-content">
            <div class="form-section">
                <h2>üõçÔ∏è Nova Compra</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cartaoCompra">Cart√£o</label>
                        <select id="cartaoCompra" required>
                            <option value="">Selecione o cart√£o</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dataCompra">Data da Compra</label>
                        <input type="date" id="dataCompra" required>
                    </div>
                    <div class="form-group">
                        <label for="descricaoCompra">Descri√ß√£o</label>
                        <input type="text" id="descricaoCompra" placeholder="Ex: Netflix, Supermercado" required>
                    </div>
                    <div class="form-group">
                        <label for="categoriaCompra">Categoria</label>
                        <select id="categoriaCompra">
                            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                            <option value="Transporte">Transporte</option>
                            <option value="Entretenimento">Entretenimento</option>
                            <option value="Assinaturas">Assinaturas</option>
                            <option value="Sa√∫de">Sa√∫de</option>
                            <option value="Roupas">Roupas</option>
                            <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                            <option value="Casa">Casa</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="valorCompra">Valor (R$)</label>
                        <input type="number" id="valorCompra" step="0.01" min="0" placeholder="0,00" required>
                    </div>
                    <div class="form-group">
                        <label for="parcelasCompra">Parcelas</label>
                        <select id="parcelasCompra" required>
                            <option value="1">1x</option>
                            <option value="2">2x</option>
                            <option value="3">3x</option>
                            <option value="4">4x</option>
                            <option value="5">5x</option>
                            <option value="6">6x</option>
                            <option value="7">7x</option>
                            <option value="8">8x</option>
                            <option value="9">9x</option>
                            <option value="10">10x</option>
                            <option value="11">11x</option>
                            <option value="12">12x</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="adicionarCompra()">
                    ‚ûï Registrar Compra
                </button>
            </div>

            <div class="table-container">
                <h3 style="padding: 20px; margin: 0; background: #f8fafc;">√öltimas Compras</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Cart√£o</th>
                            <th>Descri√ß√£o</th>
                            <th>Categoria</th>
                            <th>Valor</th>
                            <th>Parcelas</th>
                            <th>Valor/Parcela</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaCompras">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Aba de Visualiza√ß√£o -->
        <div id="visualizacao" class="tab-content">
            <div class="visualization-card">
                <h2>üìä Resumo de Gastos</h2>
                <div class="filters">
                    <div class="filter-group">
                        <label for="filtroCartao">Cart√£o</label>
                        <select id="filtroCartao" onchange="atualizarResumo()">
                            <option value="">Todos os cart√µes</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroMes">M√™s/Ano</label>
                        <select id="filtroMes" onchange="atualizarResumo()">
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" onclick="atualizarResumo()">
                            üîÑ Atualizar
                        </button>
                    </div>
                </div>

                <div class="summary-total" id="totalGastos">R$ 0,00</div>
                <p style="text-align: center; color: #6b7280;" id="infoResumo">Selecione um per√≠odo</p>
            </div>

            <div class="table-container">
                <h3 style="padding: 20px; margin: 0; background: #f8fafc;">Detalhamento</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Descri√ß√£o</th>
                            <th>Cart√£o</th>
                            <th>Parcela</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaResumo">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let SPREADSHEET_ID = '';
        let isConnected = false;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dataCompra').value = new Date().toISOString().split('T')[0];
            preencherMeses();
            
            // Verificar se j√° existe uma conex√£o salva
            const savedSpreadsheetId = localStorage.getItem('spreadsheetId');
            if (savedSpreadsheetId) {
                document.getElementById('spreadsheetId').value = savedSpreadsheetId;
                SPREADSHEET_ID = savedSpreadsheetId;
                mostrarConfigCartoes();
                carregarDados();
            }
        });

        function switchTab(tabName) {
            // Ocultar todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover classe active de todos os bot√µes
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName).classList.add('active');
            
            // Ativar bot√£o correspondente
            event.target.classList.add('active');

            // Carregar dados se necess√°rio
            if (tabName === 'compras' || tabName === 'visualizacao') {
                carregarDados();
            }
        }

        function mostrarStatus(mensagem, tipo = 'info') {
            const status = document.getElementById('connectionStatus');
            status.className = `status-message status-${tipo}`;
            status.textContent = mensagem;
            status.classList.remove('hidden');
        }

        function conectarPlanilha() {
            const spreadsheetId = document.getElementById('spreadsheetId').value.trim();
            
            if (!spreadsheetId) {
                mostrarStatus('Por favor, insira o ID da planilha', 'error');
                return;
            }

            SPREADSHEET_ID = spreadsheetId;
            localStorage.setItem('spreadsheetId', spreadsheetId);
            
            mostrarStatus('Conectado com sucesso! Agora voc√™ pode configurar seus cart√µes.', 'success');
            mostrarConfigCartoes();
            inicializarPlanilha();
        }

        function mostrarConfigCartoes() {
            document.getElementById('cartoesConfig').style.display = 'block';
            isConnected = true;
        }

        async function inicializarPlanilha() {
            // Criar as abas necess√°rias na planilha
            const data = [
                // Aba Cart√µes
                ['Nome', 'Fechamento', 'Vencimento', 'Limite'],
                
                // Dados de exemplo para Compras (ser√° limpo depois)
                ['Data', 'Cart√£o', 'Descri√ß√£o', 'Categoria', 'Valor Total', 'Parcelas', 'Valor Parcela']
            ];
            
            mostrarStatus('Planilha inicializada! Pronta para uso.', 'success');
        }

        function adicionarCartao() {
            if (!isConnected) {
                mostrarStatus('Conecte-se primeiro √† planilha!', 'error');
                return;
            }

            const nome = document.getElementById('nomeCartao').value.trim();
            const fechamento = document.getElementById('diaFechamento').value;
            const vencimento = document.getElementById('diaVencimento').value;
            const limite = document.getElementById('limiteCartao').value || '0';

            if (!nome || !fechamento || !vencimento) {
                mostrarStatus('Preencha todos os campos obrigat√≥rios do cart√£o!', 'error');
                return;
            }

            // Adicionar √† tabela local
            const tbody = document.getElementById('tabelaCartoes');
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${nome}</td>
                <td>Dia ${fechamento}</td>
                <td>Dia ${vencimento}</td>
                <td class="currency">R$ ${parseFloat(limite).toFixed(2).replace('.', ',')}</td>
                <td>
                    <button class="btn btn-danger" onclick="excluirCartao(this)">üóëÔ∏è</button>
                </td>
            `;

            // Adicionar ao select de compras
            const selectCartao = document.getElementById('cartaoCompra');
            const option = document.createElement('option');
            option.value = nome;
            option.textContent = nome;
            selectCartao.appendChild(option);

            // Adicionar ao filtro
            const filtroCartao = document.getElementById('filtroCartao');
            const optionFiltro = document.createElement('option');
            optionFiltro.value = nome;
            optionFiltro.textContent = nome;
            filtroCartao.appendChild(optionFiltro);

            // Simular salvamento na planilha
            mostrarStatus(`Cart√£o ${nome} adicionado com sucesso!`, 'success');
            
            // Limpar formul√°rio
            document.getElementById('nomeCartao').value = '';
            document.getElementById('diaFechamento').value = '';
            document.getElementById('diaVencimento').value = '';
            document.getElementById('limiteCartao').value = '';
        }

        function excluirCartao(botao) {
            if (confirm('Tem certeza que deseja excluir este cart√£o?')) {
                const row = botao.closest('tr');
                const nomeCartao = row.cells[0].textContent;
                
                // Remover da tabela
                row.remove();
                
                // Remover do select
                const selectCartao = document.getElementById('cartaoCompra');
                const optionToRemove = selectCartao.querySelector(`option[value="${nomeCartao}"]`);
                if (optionToRemove) optionToRemove.remove();
                
                // Remover do filtro
                const filtroCartao = document.getElementById('filtroCartao');
                const optionFiltroToRemove = filtroCartao.querySelector(`option[value="${nomeCartao}"]`);
                if (optionFiltroToRemove) optionFiltroToRemove.remove();
                
                mostrarStatus(`Cart√£o ${nomeCartao} removido!`, 'success');
            }
        }

        function adicionarCompra() {
            if (!isConnected) {
                mostrarStatus('Conecte-se primeiro √† planilha!', 'error');
                return;
            }

            const cartao = document.getElementById('cartaoCompra').value;
            const data = document.getElementById('dataCompra').value;
            const descricao = document.getElementById('descricaoCompra').value.trim();
            const categoria = document.getElementById('categoriaCompra').value;
            const valor = parseFloat(document.getElementById('valorCompra').value);
            const parcelas = parseInt(document.getElementById('parcelasCompra').value);

            if (!cartao || !data || !descricao || !valor || !parcelas) {
                mostrarStatus('Preencha todos os campos da compra!', 'error');
                return;
            }

            const valorParcela = valor / parcelas;

            // Adicionar √† tabela de compras
            const tbody = document.getElementById('tabelaCompras');
            const row = tbody.insertRow(0); // Adicionar no topo
            row.innerHTML = `
                <td>${new Date(data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                <td>${cartao}</td>
                <td>${descricao}</td>
                <td>${categoria}</td>
                <td class="currency">R$ ${valor.toFixed(2).replace('.', ',')}</td>
                <td>${parcelas}x</td>
                <td class="currency">R$ ${valorParcela.toFixed(2).replace('.', ',')}</td>
            `;

            // Simular salvamento na planilha
            mostrarStatus(`Compra registrada: ${descricao} - R$ ${valor.toFixed(2)}`, 'success');
            
            // Limpar formul√°rio
            document.getElementById('cartaoCompra').value = '';
            document.getElementById('descricaoCompra').value = '';
            document.getElementById('valorCompra').value = '';
            document.getElementById('parcelasCompra').value = '1';
            document.getElementById('dataCompra').value = new Date().toISOString().split('T')[0];
        }

        function preencherMeses() {
            const select = document.getElementById('filtroMes');
            const hoje = new Date();
            
            select.innerHTML = '<option value="">Selecione o m√™s</option>';
            
            for (let i = -6; i <= 12; i++) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() + i, 1);
                const mesAno = `${String(data.getMonth() + 1).padStart(2, '0')}/${data.getFullYear()}`;
                const nomesMes = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const nomeCompleto = `${nomesMes[data.getMonth()]} ${data.getFullYear()}`;
                
                const option = document.createElement('option');
                option.value = mesAno;
                option.textContent = nomeCompleto;
                
                if (i === 1) { // Pr√≥ximo m√™s como padr√£o
                    option.selected = true;
                }
                
                select.appendChild(option);
            }
        }

        function atualizarResumo() {
            const cartaoFiltro = document.getElementById('filtroCartao').value;
            const mesFiltro = document.getElementById('filtroMes').value;
            
            if (!mesFiltro) {
                document.getElementById('totalGastos').textContent = 'R$ 0,00';
                document.getElementById('infoResumo').textContent = 'Selecione um per√≠odo';
                document.getElementById('tabelaResumo').innerHTML = '';
                return;
            }

            // Simular c√°lculo de gastos
            let total = 0;
            const tbody = document.getElementById('tabelaResumo');
            tbody.innerHTML = '';

            // Exemplo de dados (em uma implementa√ß√£o real, viriam da planilha)
            const exemplos = [
                { descricao: 'Netflix', cartao: 'Nubank', parcela: '1/1', valor: 29.90 },
                { descricao: 'Supermercado', cartao: 'Inter', parcela: '1/3', valor: 150.00